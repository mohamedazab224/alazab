<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Al-azab.co Webhook Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background-color: #111;
      color: white;
      padding: 10px 0;
    }
    header img {
      height: 60px;
    }
    .banner {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
    }
    form {
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 400px;
      text-align: left;
    }
    label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    button {
      background: #111;
      color: #f5bf23;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }
    button:hover {
      background: #333;
    }
    table {
      width: 90%;
      border-collapse: collapse;
      margin: 20px auto;
      background: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    table th, table td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    table th {
      background: #111;
      color: #f5bf23;
      position: sticky;
      top: 0;
    }
    .custom-vars {
      font-size: 0.8em;
      color: #555;
      max-width: 200px;
      word-break: break-all;
    }
    #response {
      margin: 15px auto;
      padding: 10px;
      border-radius: 5px;
      max-width: 400px;
      font-weight: bold;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .loading {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .event-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    .event-delivered {
      background: #d4edda;
      color: #155724;
    }
    .event-opened {
      background: #cce7ff;
      color: #004085;
    }
    .event-failed {
      background: #f8d7da;
      color: #721c24;
    }
    .controls {
      margin: 20px 0;
    }
    .controls button {
      width: auto;
      margin: 5px;
    }
  </style>
</head>
<body>
  <!-- Logo -->
  <header>
    <img src="https://al-azab.co/w.png" alt="Al-azab.co Logo" onerror="this.style.display='none'">
  </header>

  <!-- Banner -->
  <img class="banner" src="https://al-azab.co/images/baner.jpg" alt="Al-azab.co Banner" onerror="this.style.display='none'">

  <div class="container">
    <!-- Form -->
    <h2>Webhook Test Form</h2>
    <form id="webhookForm">
      <label>
        Event Type:
        <select name="event" required>
          <option value="">Select Event</option>
          <option value="delivery">Delivery</option>
          <option value="opened">Opened</option>
          <option value="clicked">Clicked</option>
          <option value="bounced">Bounced</option>
          <option value="complained">Complained</option>
          <option value="user.signup">User Signup</option>
          <option value="password.reset">Password Reset</option>
        </select>
      </label>

      <label>
        Email:
        <input type="email" name="email" placeholder="user@example.com" value="azab68320@gmail.com" required>
      </label>

      <label>
        Status:
        <select name="status">
          <option value="success">Success</option>
          <option value="failed">Failed</option>
          <option value="pending">Pending</option>
        </select>
      </label>

      <label>
        Custom Data (JSON):
        <textarea name="custom_data" placeholder='{"key": "value"}' rows="3" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px;"></textarea>
      </label>

      <button type="submit">Send Webhook Test</button>
    </form>

    <div id="response"></div>

    <!-- Controls -->
    <div class="controls">
      <button onclick="simulateRealEvent()">üéØ Simulate Real Event</button>
      <button onclick="clearTable()">üóëÔ∏è Clear Table</button>
      <button onclick="exportData()">üìä Export Data</button>
    </div>

    <h1>Webhook Events</h1>
    <table id="eventsTable">
      <thead>
        <tr>
          <th>Event</th>
          <th>Category</th>
          <th>Email</th>
          <th>Status</th>
          <th>Message ID</th>
          <th>Timestamp</th>
          <th>Domain</th>
          <th>Custom Variables</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let events = [];
    const webhookUrl = 'https://your-server.com/webhook'; // ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿ®ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ± ÿßŸÑÿ≠ŸÇŸäŸÇŸä

    // ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ´ÿßŸÑ ŸàÿßŸÇÿπŸäÿ©
    const sampleEvents = [
      {
        "event": "delivery",
        "category": "Password reset",
        "custom_variables": { "user_id": "12345", "action": "password_reset" },
        "message_id": "1df37d17-0286-4d8b-8edf-bc4ec5be86e6",
        "email": "support@alazab.com",
        "event_id": "bede7236-2284-43d6-a953-1fdcafd0fdbc",
        "timestamp": Math.floor(Date.now() / 1000),
        "sending_domain_name": "alazab.com",
        "status": "success"
      },
      {
        "event": "opened",
        "category": "Welcome Email",
        "custom_variables": { "plan": "premium", "source": "website" },
        "message_id": "ca7974af-7212-42aa-99fb-cc4742d0658b",
        "email": "azab68320@gmail.com",
        "event_id": "657b8544-6a95-4c47-997f-6e47922a5052",
        "timestamp": Math.floor(Date.now() / 1000) - 3600,
        "sending_domain_name": "alazab.com",
        "status": "success"
      }
    ];

    // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸäÿ©
    document.addEventListener('DOMContentLoaded', function() {
      sampleEvents.forEach(event => addEventToTable(event));
    });

    // ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿØÿ´ ŸÑŸÑÿ¨ÿØŸàŸÑ
    function addEventToTable(event) {
      const tableBody = document.querySelector("#eventsTable tbody");
      const row = document.createElement("tr");
      
      const eventClass = `event-${event.event}`;
      const statusClass = event.status === 'success' ? 'event-delivered' : 
                         event.status === 'failed' ? 'event-failed' : 'event-opened';

      row.innerHTML = `
        <td><span class="event-badge ${eventClass}">${event.event}</span></td>
        <td>${event.category}</td>
        <td>${event.email}</td>
        <td><span class="event-badge ${statusClass}">${event.status}</span></td>
        <td>${event.message_id}</td>
        <td>${new Date(event.timestamp * 1000).toLocaleString()}</td>
        <td>${event.sending_domain_name}</td>
        <td class="custom-vars">${JSON.stringify(event.custom_variables)}</td>
        <td>
          <button onclick="resendEvent('${event.event_id}')" style="font-size:12px; padding:4px 8px;">‚Üª</button>
          <button onclick="deleteEvent('${event.event_id}')" style="font-size:12px; padding:4px 8px; background:#dc3545;">√ó</button>
        </td>
      `;

      tableBody.appendChild(row);
      events.push(event);
    }

    // ÿ•ÿ±ÿ≥ÿßŸÑ Webhook
    document.getElementById('webhookForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const responseDiv = document.getElementById('response');
      
      // ÿπÿ±ÿ∂ ÿ™ÿ≠ŸÖŸäŸÑ
      responseDiv.className = 'loading';
      responseDiv.innerText = "‚è≥ Sending webhook...";

      const data = {
        company: "Al-azab.co",
        event: formData.get('event'),
        email: formData.get('email'),
        status: formData.get('status'),
        custom_data: formData.get('custom_data') ? JSON.parse(formData.get('custom_data')) : {},
        timestamp: Math.floor(Date.now() / 1000),
        message_id: generateMessageId(),
        event_id: generateEventId()
      };

      try {
        // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ•ÿ±ÿ≥ÿßŸÑ Webhook ÿ≠ŸÇŸäŸÇŸä
        const res = await fetch(webhookUrl, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'X-Webhook-Source': 'alazab-test'
          },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          responseDiv.className = 'success';
          responseDiv.innerText = "‚úÖ Webhook sent successfully!";
          
          // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ≠ÿØÿ´ ŸÑŸÑÿ¨ÿØŸàŸÑ
          addEventToTable({
            ...data,
            category: data.event,
            sending_domain_name: "alazab.com",
            custom_variables: data.custom_data
          });
        } else {
          throw new Error(`HTTP ${res.status}`);
        }
      } catch (err) {
        responseDiv.className = 'error';
        responseDiv.innerText = `‚ùå Failed to send webhook: ${err.message}`;
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÉÿ≤ÿ± ŸÑÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©
        const retryBtn = document.createElement('button');
        retryBtn.textContent = ' Retry';
        retryBtn.onclick = () => document.getElementById('webhookForm').dispatchEvent(new Event('submit'));
        retryBtn.style.marginLeft = '10px';
        responseDiv.appendChild(retryBtn);
      }
    });

    // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ≠ÿØÿ´ ÿ≠ŸÇŸäŸÇŸä
    function simulateRealEvent() {
      const realEvents = [
        {
          event: "delivery",
          category: "Order Confirmation",
          email: "customer@example.com",
          status: "success",
          custom_variables: { "order_id": "ORD-2025-001", "amount": "150.00" }
        },
        {
          event: "bounced",
          category: "Newsletter",
          email: "invalid@domain.com",
          status: "failed",
          custom_variables: { "campaign": "weekly-news", "reason": "invalid_email" }
        }
      ];
      
      const randomEvent = realEvents[Math.floor(Math.random() * realEvents.length)];
      const eventData = {
        ...randomEvent,
        message_id: generateMessageId(),
        event_id: generateEventId(),
        timestamp: Math.floor(Date.now() / 1000),
        sending_domain_name: "alazab.com"
      };
      
      addEventToTable(eventData);
      
      const responseDiv = document.getElementById('response');
      responseDiv.className = 'success';
      responseDiv.innerText = `‚úÖ Simulated ${eventData.event} event for ${eventData.email}`;
    }

    // ŸÖÿ≥ÿ≠ ÿßŸÑÿ¨ÿØŸàŸÑ
    function clearTable() {
      document.querySelector("#eventsTable tbody").innerHTML = '';
      events = [];
      document.getElementById('response').innerText = "üóëÔ∏è Table cleared";
    }

    // ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    function exportData() {
      const dataStr = JSON.stringify(events, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `webhook-events-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
    }

    // ÿ•ÿπÿßÿØÿ© ÿ•ÿ±ÿ≥ÿßŸÑ ÿ≠ÿØÿ´
    function resendEvent(eventId) {
      const event = events.find(e => e.event_id === eventId);
      if (event) {
        alert(`Resending event: ${event.event} for ${event.email}`);
        // ŸáŸÜÿß ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàÿØ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ≠ŸÇŸäŸÇŸä
      }
    }

    // ÿ≠ÿ∞ŸÅ ÿ≠ÿØÿ´
    function deleteEvent(eventId) {
      if (confirm('Are you sure you want to delete this event?')) {
        events = events.filter(e => e.event_id !== eventId);
        document.querySelectorAll("#eventsTable tbody tr").forEach(row => {
          if (row.cells[4].textContent === eventId) {
            row.remove();
          }
        });
      }
    }

    // ÿ™ŸàŸÑŸäÿØ IDs
    function generateMessageId() {
      return 'msg_' + Math.random().toString(36).substr(2, 9);
    }

    function generateEventId() {
      return 'evt_' + Math.random().toString(36).substr(2, 9);
    }

    // ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÉŸÑ 30 ÿ´ÿßŸÜŸäÿ© (ŸÖÿ≠ÿßŸÉÿßÿ© events ÿ≠ŸÇŸäŸÇŸäÿ©)
    setInterval(() => {
      if (Math.random() > 0.7) { // 30% chance
        simulateRealEvent();
      }
    }, 30000);
  </script>
</body>
</html>
